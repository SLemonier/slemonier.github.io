<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/_astro/favicon.CpNGb_Q3.png"><meta name="generator" content="Astro v4.16.0"><!-- Canonical URL --><link rel="canonical" href="https://devolio.devaradise.com/james-rankins-first-autologon-automated/"><!-- Primary Meta Tags --><title>James Rankin&#39;s first autologon automated</title><meta name="title" content="James Rankin's first autologon automated"><meta name="description" content="James Rankin's first autologon automated."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://devolio.devaradise.com/james-rankins-first-autologon-automated/"><meta property="og:title" content="James Rankin's first autologon automated"><meta property="og:description" content="James Rankin's first autologon automated."><meta property="og:image" content="https://devolio.devaradise.com/_astro/title_powershell.B_-WyO3_.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://devolio.devaradise.com/james-rankins-first-autologon-automated/"><meta property="twitter:title" content="James Rankin's first autologon automated"><meta property="twitter:description" content="James Rankin's first autologon automated."><meta property="twitter:image" content="https://devolio.devaradise.com/_astro/title_powershell.B_-WyO3_.jpg"><link rel="stylesheet" href="/_astro/_slug_.DwNs2Nve.css">
<style>.toc-list[data-astro-cid-awg4b4gg]::-webkit-scrollbar{width:5px}.toc-list[data-astro-cid-awg4b4gg]::-webkit-scrollbar-track{background:transparent}.toc-list[data-astro-cid-awg4b4gg]::-webkit-scrollbar-thumb{background:#eee;border-radius:5px}.dark .toc-list[data-astro-cid-awg4b4gg]::-webkit-scrollbar-thumb{background:#2e2e2e;border-radius:5px}
</style><script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[])})(window,'partytown','forward');/* Partytown 0.10.2 - MIT builder.io */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,d,l,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(l=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(v,1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.10.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<l.length;n++)(o=r.createElement("script")).innerHTML=l[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(d)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="bg-white dark:bg-zinc-900 dark:text-zinc-100 pt-16 sm:pt-0"> <header id="site-header" class="flex items-center w-full transition duration-300 z-[999] border-[var(--soft-border-color)]"> <div class="container"> <nav class="flex gap-4 items-center justify-between py-3"> <h2 class="m-0"> <a href="/" class="flex gap-4 items-center text-xl font-black uppercase"> <!-- You can use your site logo, rounded ava or simply your site name here--> <img src="/_astro/small-ava.nMcaqXHj_Z1y66Kx.webp" alt="Your site name" class="rounded-full w-11 border-white border-2 shadow-lg" width="96" height="96" loading="lazy" decoding="async"> <!-- {SITE_TITLE} --> </a> </h2> <div class="flex"> <button class="p-3" id="themeToggle" aria-label="Theme mode"> <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg> <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon"> <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg> </button> </div> </nav> <div class="fixed top-3 w-auto max-w-full px-3 left-1/2 -translate-x-1/2 z-[999]"> <div class="flex px-2.5 bg-white/90 dark:bg-zinc-900/75 backdrop-blur-md leading-tight rounded-full border dark:border-zinc-700"> <div class="px-2.5 text-sm"> <a href="/" class="py-3 flex items-center text-zinc-600 dark:text-zinc-200 hover:text-zinc-900 dark:hover:text-zinc-50" aria-label="Home">  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg>  </a> </div> <div class="px-2.5 text-sm"> <a href="/about/" class="py-3 flex items-center text-zinc-600 dark:text-zinc-200 hover:text-zinc-900 dark:hover:text-zinc-50"> About </a> </div><div class="px-2.5 text-sm"> <a href="/posts/" class="py-3 flex items-center text-zinc-600 dark:text-zinc-200 hover:text-zinc-900 dark:hover:text-zinc-50"> Posts </a> </div><div class="px-2.5 text-sm"> <a href="/projects/" class="py-3 flex items-center text-zinc-600 dark:text-zinc-200 hover:text-zinc-900 dark:hover:text-zinc-50"> Projects </a> </div><div class="px-2.5 text-sm"> <a href="/tags/" class="py-3 flex items-center text-zinc-600 dark:text-zinc-200 hover:text-zinc-900 dark:hover:text-zinc-50"> Tags </a> </div> </div> </div> </div>  <script>
		const theme = (() => {
			if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
				return 'dark';
			}
			if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
				return localStorage.getItem('theme');
			}
			return 'light';
		})();

		if (theme === 'light') {
			document.documentElement.classList.remove('dark');
		} else {
			document.documentElement.classList.add('dark');
		}

		window.localStorage.setItem('theme', theme || '');

		function sendMessage(message) {
			const iframe = document.querySelector('iframe.giscus-frame');
			if (!iframe) return;
			iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
		}

		const handleToggleClick = () => {
			const element = document.documentElement;
			element.classList.toggle('dark');

			const isDark = element.classList.contains('dark');
			if (isDark) {
				sendMessage({
					setConfig: {
						theme: 'dark_dimmed'
					}
				});
			} else {
				sendMessage({
					setConfig: {
						theme: 'light'
					}
				});
			}
			localStorage.setItem('theme', isDark ? 'dark' : 'light');
		};
		document.getElementById('themeToggle')?.addEventListener('click', handleToggleClick);
	</script> </header> <div class="py-8 min-h-[calc(100vh-160px)]">  <div class="container lg:flex gap-10"> <main class="overflow-hidden grow"> <article> <div class="prose dark:prose-invert
  prose-h1:font-[900] prose-h1:my-4 prose-h1:text-2xl sm:prose-h1:text-[2rem]/[1.3]
  prose-h2:mt-6 prose-h2:mb-3 prose-h2:text-2xl sm:prose-h2:text-3xl prose-h2:font-extrabold
  prose-h3:mt-5 prose-h3:mb-2 prose-h3:text-xl sm:prose-h3:text-2xl
  prose-h4:mt-3 prose-h4:mb-0 prose-img:rounded-xl prose-h3:target:pt-20">  <div> <h1 class="!my-1 leading-tight">James Rankin&#39;s first autologon automated</h1> <div class="text-sm font-[500] mt-2 sm:mt-0 py-1 md:text-right flex flex-col sm:flex-row gap-3 sm:justify-between sm:items-center"> <div class="flex gap-2"> <a class="border border-zinc-300 dark:border-zinc-700 rounded-2xl
                          text-sm text-zinc-700 dark:text-zinc-300 no-underline px-2 py-0.5
                          transition-all duration-700
                        hover:border-zinc-700 dark:hover:border-zinc-300" href="/tags/powershell"> PowerShell </a><a class="border border-zinc-300 dark:border-zinc-700 rounded-2xl
                          text-sm text-zinc-700 dark:text-zinc-300 no-underline px-2 py-0.5
                          transition-all duration-700
                        hover:border-zinc-700 dark:hover:border-zinc-300" href="/tags/windows"> Windows </a><a class="border border-zinc-300 dark:border-zinc-700 rounded-2xl
                          text-sm text-zinc-700 dark:text-zinc-300 no-underline px-2 py-0.5
                          transition-all duration-700
                        hover:border-zinc-700 dark:hover:border-zinc-300" href="/tags/automation"> Automation </a> </div> <div> Updated on <strong><time datetime="2020-12-02T00:00:00.000Z"> Dec 02, 2020 </time></strong> </div> </div> </div> <div class="py-3 overflow-hidden"> <img src="/_astro/title_powershell.B_-WyO3__rMkR6.webp" class="rounded-3xl w-full m-0 lg:mb-2" alt="James Rankin's first autologon automated" loading="eager" width="2000" height="1500" decoding="async"> </div> <p>Last month, well-known Citrix Expert James Rankin released the <a href="https://james-rankin.com/articles/the-ultimate-guide-to-windows-logon-optimizations-part-3/" target="_blank" rel="noopener">part 3 of his new series about Windows logon time optimizations</a>. We are all aware of logon duration and how much it can be a pain to deal with in our environments, especially since Microsoft added more and more features to its operating system.</p>
<p>New versions continue to increase user logon duration and can raise up to one minute before letting users do their work. One minute does not sound like a big deal. But depending on the context, it can be a hell of a difference (think about hospitals). Thus, any improvement we can make on this part is helpful and must be implemented.</p>
<p>Even if our current logon times are acceptable, it is our duty, as experts, to deliver the best experiences and performances we can offer. Companies don’t pay us for clicking “next, next, next” on an installer. They pay us for all the knowledge we have and can leverage on.</p>
<p>So, when James Rankin shared about how to automatize the first logon after pointing out later ones are always faster in his article, I wondered if I can go a bit further in the automation of this. He does it through a couple of GPO, I personally am a “put-everything-you-can-in-your-Golden-Image” guy. I don’t have any argument here to justify one approach over the other. I was trained this way, to keep the GPO as minimal as possible. But share your thoughts on this one if you feel your way is better.</p>
<p>In the upcoming months, I am projecting to automatize the creation of my Golden Image on a regular basis, thanks to Packer and Ansible, and this first automated logon should be part of it.</p>
<p>And there is always something new to learn.</p>
<p>Take the first part of James Rankin’s implementation : a shutdown script.</p>
<p>How would you proceed without GPO ? First, I tried with a scheduled task. There is no trigger for the shutdown of a computer. Then, I thought about capturing the event 6006. It did not work. I ended up on an article about implementing the equivalent of local gpedit.msc shutdown script through the registry. It is not the cleanest way to do so, in my opinion, but it does the job. If you have any idea how to improve this part, please share it, I’ll be glad to add your contribution.</p>
<p>The remaining parts were straight forward actually: set an autologon script for the autologon user to autologoff (high-five if you understood this at first read ✋).</p>
<p>Of course, I added some verification, like checking <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/autologon" target="_blank" rel="noopener">Sysinternal tool Autologon</a> is available on the system.</p>
<p>You will probably wonder by seeing the script why I don’t Convert-ToSecureString the password parameter or require to have it secured prior to the script’s execution. Well, I am not entirely sure how it would handle this part with Packer or Ansible. So, I preferred to keep it simple but have in mind the autologon account will have its password stored in clear text in SetAutologon.bat.</p>
<p>Maybe I could set some ACLs on this file in a V2. 🤔</p>
<p>The script is pretty easy to call:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>.\SetAutologon.ps1 -Account leogetz -Password okay-okay-okay!</span></span>
<span class="line"><span></span></span></code></pre>
<p>SetAutologon.ps1 -Account leogetz -Password okay-okay-okay!
As usual, I added some parameters to set the path where to store the scripts (default is C:\Script) and the output file for the log (default is the current directory).</p>
<p>Okay ! You’ll find the <a href="https://github.com/SLemonier/CitrixAutomation/blob/main/SetAutologon.ps1" target="_blank" rel="noopener">latest version on Github</a>, feel free to share your comments, your improvement’s ideas or custom it your way!</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;#</span></span>
<span class="line"><span> .Synopsis</span></span>
<span class="line"><span> Configure local machine for autologon as described in James Rankin's article (https://james-rankin.com/articles/the-ultimate-guide-to-windows-logon-optimizations-part-3/).</span></span>
<span class="line"><span> .Description</span></span>
<span class="line"><span> Configure local machine autologon with given account (no need to specify the domain) and password.</span></span>
<span class="line"><span> Configure logon script for the given account to logoff automatically.</span></span>
<span class="line"><span> .Parameter Account</span></span>
<span class="line"><span> Specifiy the account to use for autologon.</span></span>
<span class="line"><span> This parameter is mandatory, ensure the account already exists in the domain.</span></span>
<span class="line"><span> .Parameter Password</span></span>
<span class="line"><span> Specifiy the account's password to use for autologon.</span></span>
<span class="line"><span> This parameter is mandatory, ensure the password is correct.</span></span>
<span class="line"><span> .Parameter Path</span></span>
<span class="line"><span> Specify the folder where to store batches created by the script.</span></span>
<span class="line"><span> This parameter is optionnal, by default, it will store in C:\Scripts.</span></span>
<span class="line"><span> .Parameter Log</span></span>
<span class="line"><span> Specifiy the output file for the logs.</span></span>
<span class="line"><span> This parameter is optionnal, by default, it will create a file in the current directory.</span></span>
<span class="line"><span> .Example</span></span>
<span class="line"><span> # Configure local machine to autolog the user leogetz with the password P@ssw0rd</span></span>
<span class="line"><span> SetAutologon.ps1 -Account leogetz -Password P@ssw0rd</span></span>
<span class="line"><span> .Example</span></span>
<span class="line"><span> # Configure local machine to autolog the user leogetz with the password P@ssw0rd and store the scripts in C:\Tmp</span></span>
<span class="line"><span> SetAutologon.ps1 -Account leogetz -Password P@ssw0rd -Path C:\Tmp</span></span>
<span class="line"><span> .Example</span></span>
<span class="line"><span> # Configure local machine to autolog the user leogetz with the password P@ssw0rd and store the scripts in C:\Tmp</span></span>
<span class="line"><span>  and log the output in C:\Temp</span></span>
<span class="line"><span> SetAutologon.ps1 -Account leogetz -Password P@ssw0rd -Path C:\Tmp -Log "C:\temp\test.log"</span></span>
<span class="line"><span>#></span></span>
<span class="line"><span></span></span>
<span class="line"><span>[CmdletBinding()]</span></span>
<span class="line"><span>Param(</span></span>
<span class="line"><span>    # Declaring input variables for the script</span></span>
<span class="line"><span>    [Parameter(Mandatory=$true)] [string]$Account,</span></span>
<span class="line"><span>    [Parameter(Mandatory=$true)] [string]$Password,</span></span>
<span class="line"><span>    [Parameter(Mandatory=$false)] [string]$Path="C:\Scripts",</span></span>
<span class="line"><span>    [Parameter(Mandatory=$false)][ValidateNotNullOrEmpty()] [string]$LogFile=".\SetAutologon.log"</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#Start logging</span></span>
<span class="line"><span>Start-Transcript -Path $LogFile</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#Setting variables prior to their usage is not mandatory</span></span>
<span class="line"><span>Set-StrictMode -Version 2</span></span>
<span class="line"><span></span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span>#Checking the parameters</span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Write-Host "Checking Path..." -NoNewline</span></span>
<span class="line"><span>if(Test-Path -Path $Path){</span></span>
<span class="line"><span>    Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>} else {</span></span>
<span class="line"><span>    New-Item -ItemType Directory -Path $Path | Out-Null</span></span>
<span class="line"><span>    Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span>#Checking the pre-requisites</span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Write-Host "Checking Sysinternal tool Autologon... " -NoNewline</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>    autologon64 $Account $env:USERDOMAIN $Password /accepteula</span></span>
<span class="line"><span>    Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>catch {</span></span>
<span class="line"><span>    Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>    Write-Host "Sysinternal tool Autologon is not available. Please download from https://docs.microsoft.com/en-us/sysinternals/downloads/autologon and unzip Autologon64.exe in default system Path (for instance ""C:\windows\system32\"")" -ForegroundColor Red</span></span>
<span class="line"><span>    Stop-Transcript </span></span>
<span class="line"><span>    break</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span>#Creating Autologon</span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Write-Host "Creating Autologon batch... " -NoNewline</span></span>
<span class="line"><span>if(!(Test-Path -Path C:\Windows\System32\GroupPolicy\Machine\SetAutologon.bat)){</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        Write-Host "Adding autologon64 $Account $env:USERDOMAIN $Password /accepteula to C:\Windows\System32\GroupPolicy\Machine\SetAutologon.bat... " -NoNewline -ForegroundColor Yellow</span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\Machine")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\Machine" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }  </span></span>
<span class="line"><span>        New-Item -Path C:\Windows\System32\GroupPolicy\Machine\ -Name SetAutologon.bat -ItemType File | Out-Null</span></span>
<span class="line"><span>        Set-Content -Path C:\Windows\System32\GroupPolicy\Machine\SetAutologon.bat  "autologon64 $Account $env:USERDOMAIN $Password /accepteula" -Encoding ASCII</span></span>
<span class="line"><span>        Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    catch {</span></span>
<span class="line"><span>        Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>        Stop-Transcript </span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>} else {</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        Remove-Item -Path C:\Windows\System32\GroupPolicy\Machine\SetAutologon.bat -Force | Out-Null</span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\Machine")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\Machine" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }  </span></span>
<span class="line"><span>        New-Item -Path C:\Windows\System32\GroupPolicy\Machine\ -Name SetAutologon.bat -ItemType File | Out-Null</span></span>
<span class="line"><span>        Write-Host "Adding autologon64 $Account $env:USERDOMAIN $Password /accepteula to C:\Windows\System32\GroupPolicy\Machine\SetAutologon.bat... " -NoNewline -ForegroundColor Yellow</span></span>
<span class="line"><span>        Set-Content -Path C:\Windows\System32\GroupPolicy\Machine\SetAutologon.bat  "autologon64 $Account $env:USERDOMAIN $Password /accepteula" -Encoding ASCII</span></span>
<span class="line"><span>        Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    catch {</span></span>
<span class="line"><span>        Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>        Stop-Transcript </span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Write-Host "Creating Autologon Scheduled task... " -NoNewline</span></span>
<span class="line"><span>if(!(Get-ScheduledTask | Where-Object{$_.TaskName -match "SetAutologon"})){</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\" -Name Scripts -Force | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\" -Name Shutdown -Force | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\" -Name 0 -Force | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "GPO-ID" -Value "LocalGPO" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "SOM-ID" -Value "Local" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "FileSysPath" -Value "C:\Windows\System32\GroupPolicy\Machine" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "DisplayName" -Value "Local Group Policy" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "GPOName"  -Value "Local Group Policy" | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0\" -Name 0 -Force | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0\0" -Name "Script" -Value "SetAutologon.bat" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0\0" -Name "Parameters" -Value "" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0\0" -Name "ExecTime" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00)) | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\" -Name Scripts -Force | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\" -Name Shutdown -Force | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\" -Name 0 -Force | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "GPO-ID" -Value "LocalGPO" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "SOM-ID" -Value "Local" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "FileSysPath" -Value "C:\Windows\System32\GroupPolicy\Machine" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "DisplayName" -Value "Local Group Policy" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "GPOName"  -Value "Local Group Policy" | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\" -Name 0 -Force | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0" -Name "Script" -Value "SetAutologon.bat" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0" -Name "Parameters" -Value "" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0" -Name "IsPowershell" -Value 0 -Type dword | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0" -Name "ExecTime" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00)) | Out-Null</span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\Machine\Scripts\Startup")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\Machine\Scripts\Startup" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }   </span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\User\Scripts\Startup")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\User\Scripts\Startup" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }   </span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\Machine\Scripts\Shutdown")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\Machine\Scripts\Shutdown" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }   </span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\User\Scripts\Shutdown")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\User\Scripts\Shutdown" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    catch {</span></span>
<span class="line"><span>        Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>        Stop-Transcript </span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}else {</span></span>
<span class="line"><span>    Write-Host "Task already exists" -ForegroundColor Yellow</span></span>
<span class="line"><span>    Write-Host "Replacing existing task... " -NoNewline</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\" -Name Scripts -Force | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\" -Name Shutdown -Force | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\" -Name 0 -Force | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "GPO-ID" -Value "LocalGPO" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "SOM-ID" -Value "Local" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "FileSysPath" -Value "C:\\Windows\\System32\\GroupPolicy\\Machine" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "DisplayName" -Value "Local Group Policy" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0" -Name "GPOName"  -Value "Local Group Policy" | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0\" -Name 0 -Force | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0\0" -Name "Script" -Value "SetAutologon.bat" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0\0" -Name "Parameters" -Value "" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Shutdown\0\0" -Name "ExecTime" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00)) | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\" -Name Scripts -Force | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\" -Name Shutdown -Force | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\" -Name 0 -Force | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "GPO-ID" -Value "LocalGPO" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "SOM-ID" -Value "Local" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "FileSysPath" -Value "C:\\Windows\\System32\\GroupPolicy\\Machine" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "DisplayName" -Value "Local Group Policy" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0" -Name "GPOName"  -Value "Local Group Policy" | Out-Null</span></span>
<span class="line"><span>        New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\" -Name 0 -Force | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0" -Name "Script" -Value "SetAutologon.bat" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0" -Name "Parameters" -Value "" | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0" -Name "IsPowershell" -Value 0 -Type dword | Out-Null</span></span>
<span class="line"><span>        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Shutdown\0\0" -Name "ExecTime" -Value ([byte[]](0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00)) | Out-Null</span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\Machine\Scripts\Startup")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\Machine\Scripts\Startup" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }   </span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\User\Scripts\Startup")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\User\Scripts\Startup" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }   </span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\Machine\Scripts\Shutdown")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\Machine\Scripts\Shutdown" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }   </span></span>
<span class="line"><span>        if ( -Not (Test-Path "C:\Windows\System32\GroupPolicy\User\Scripts\Shutdown")){</span></span>
<span class="line"><span>            New-Item -Path "C:\Windows\System32\GroupPolicy\User\Scripts\Shutdown" -ItemType Directory | out-null</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>        Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    catch {</span></span>
<span class="line"><span>        Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>        Stop-Transcript </span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span>#Allowing Autologon user to amend registry key HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon</span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Write-Host "Allowing Autologon user to amend Autologon registry key... " -NoNewline</span></span>
<span class="line"><span>try {</span></span>
<span class="line"><span>    $acl = Get-Acl "HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"</span></span>
<span class="line"><span>    $rule = New-Object System.Security.AccessControl.RegistryAccessRule ("$env:USERDOMAIN\$account","FullControl","ContainerInherit,ObjectInherit","None","Allow")</span></span>
<span class="line"><span>    $acl.SetAccessRule($rule)</span></span>
<span class="line"><span>    $acl | Set-Acl -Path "HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"</span></span>
<span class="line"><span>    Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>catch {</span></span>
<span class="line"><span>    Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>    Stop-Transcript </span></span>
<span class="line"><span>    break</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span>#Creating Autologoff</span></span>
<span class="line"><span>################################################################################################</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Write-Host "Creating Autologoff batch... "</span></span>
<span class="line"><span>if(!(Test-Path -Path $Path\SetAutologoff.bat)){</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        New-Item -Path $Path -Name SetAutologoff.bat -ItemType File | Out-Null</span></span>
<span class="line"><span>        Set-Content -Path $Path\SetAutologoff.bat  "reg delete ""HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"" /v DefaultUserName /f" -Encoding ASCII</span></span>
<span class="line"><span>        Write-Host "Adding reg delete ""HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"" /v DefaultUserName /f to $Path\SetAutologoff.bat... " -ForegroundColor Yellow</span></span>
<span class="line"><span>        Set-Content -Path $Path\SetAutologoff.bat  "reg add ""HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"" /v AutoAdminLogon /t REG_SZ /d 0 /f" -Encoding ASCII</span></span>
<span class="line"><span>        Write-Host "Adding reg add ""HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"" /v AutoAdminLogon /t REG_SZ /d 0 /f to $Path\SetAutologoff.bat... " -ForegroundColor Yellow</span></span>
<span class="line"><span>        Set-Content -Path $Path\SetAutologoff.bat  "logoff" -Encoding ASCII</span></span>
<span class="line"><span>        Write-Host "Adding logoff to $Path\SetAutologoff.bat... " -ForegroundColor Yellow</span></span>
<span class="line"><span>        Write-Host "Creating Autologoff batch... " -NoNewline</span></span>
<span class="line"><span>        Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    catch {</span></span>
<span class="line"><span>        Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>        Stop-Transcript </span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>} else {</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        Remove-Item -Path $Path\SetAutologoff.bat -Force | Out-Null</span></span>
<span class="line"><span>        New-Item -Path $Path -Name SetAutologoff.bat -ItemType File | Out-Null</span></span>
<span class="line"><span>        Set-Content -Path $Path\SetAutologoff.bat  "reg delete ""HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"" /v DefaultUserName /f" -Encoding ASCII</span></span>
<span class="line"><span>        Write-Host "Adding reg delete ""HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"" /v DefaultUserName /f to $Path\SetAutologoff.bat... " -ForegroundColor Yellow</span></span>
<span class="line"><span>        Set-Content -Path $Path\SetAutologoff.bat  "reg add ""HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"" /v AutoAdminLogon /t REG_SZ /d 0 /f" -Encoding ASCII</span></span>
<span class="line"><span>        Write-Host "Adding reg add ""HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon"" /v AutoAdminLogon /t REG_SZ /d 0 /f to $Path\SetAutologoff.bat... " -ForegroundColor Yellow</span></span>
<span class="line"><span>        Set-Content -Path $Path\SetAutologoff.bat  "logoff" -Encoding ASCII</span></span>
<span class="line"><span>        Write-Host "Adding logoff to $Path\SetAutologoff.bat... " -ForegroundColor Yellow</span></span>
<span class="line"><span>        Write-Host "Creating Autologoff batch... " -NoNewline</span></span>
<span class="line"><span>        Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    catch {</span></span>
<span class="line"><span>        Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>        Stop-Transcript </span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Write-Host "Creating Autologoff Scheduled task... " -NoNewline</span></span>
<span class="line"><span>if(!(Get-ScheduledTask | Where-Object{$_.TaskName -match "SetAutologoff"})){</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        $taskAction = New-ScheduledTaskAction -Execute $Path\SetAutologoff.bat</span></span>
<span class="line"><span>        $taskTrigger = New-ScheduledTaskTrigger -AtLogOn -User "$env:USERDOMAIN\$account"</span></span>
<span class="line"><span>        Register-ScheduledTask -TaskName "SetAutologoff" -Description "Configure Autologff for $Account" -Action $taskAction -Trigger $taskTrigger -user "$env:USERDOMAIN\$Account" | Out-Null</span></span>
<span class="line"><span>        Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    catch {</span></span>
<span class="line"><span>        Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>        Stop-Transcript </span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}else {</span></span>
<span class="line"><span>    Write-Host "Task already exists" -ForegroundColor Yellow</span></span>
<span class="line"><span>    Write-Host "Replacing existing task... " -NoNewline</span></span>
<span class="line"><span>    try {</span></span>
<span class="line"><span>        Unregister-ScheduledTask -TaskName "SetAutologoff" -Confirm:$false | Out-Null</span></span>
<span class="line"><span>        $taskAction = New-ScheduledTaskAction -Execute $Path\SetAutologoff.bat</span></span>
<span class="line"><span>        $taskTrigger = New-ScheduledTaskTrigger -AtLogOn -User "$env:USERDOMAIN\$account"</span></span>
<span class="line"><span>        Register-ScheduledTask -TaskName "SetAutologoff" -Description "Configure Autologff for $Account" -Action $taskAction -Trigger $taskTrigger -user "$env:USERDOMAIN\$Account" | Out-Null</span></span>
<span class="line"><span>        Write-Host "OK" -ForegroundColor Green</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    catch {</span></span>
<span class="line"><span>        Write-Host "Failed" -ForegroundColor Red</span></span>
<span class="line"><span>        Stop-Transcript </span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#Stop logging</span></span>
<span class="line"><span>Stop-Transcript</span></span>
<span class="line"><span></span></span></code></pre>  </div>  </article> </main> <div class="shrink-0 w-[280px] hidden md:block"> <div class="mb-4"> <div class="about-the-author py-4 border-b"> <h3 class="font-extrabold uppercase mb-4 text-sm">About the Author</h3> <div class="flex gap-4 items-center leading-tight not-prose"> <a href="https://github.com/slemonier" target="_blank" rel="noopener noreferrer" class="rounded-full overflow-hidden shrink-0 w-[70px] h-[70px]"> <img src="/_astro/ava.BXbwb2Mm_1aqOIG.webp" alt="Steven Lemonier" width="724" height="1086" loading="lazy" decoding="async"> </a> <div> <div> <a href="https://github.com/slemonier" class="block font-bold text-inherit hover:text-[var(--link-color)]" target="_blank" rel="noopener noreferrer">
Steven Lemonier
</a> </div> <small class="avatar__subtitle">System Engineer</small> </div> </div> <div class="author-desc text-[.825rem] my-4"> <p class="mb-3">
Steven Lemonier is a System Engineer with extensive experience in Citrix Technologies, particularly DaaS, ADC/ADM and automation. He is actively sharing on   <a href="https://stevenlemonier.fr" target="_blank" class="underline">StevenLemonier.fr</a>.
</p> <p>Certified as a CCE-V, he actively contributes to the World of EUC and serves as a Citrix Technology Advocate. He is enthusiastic about collaborating on projects involving Citrix technologies and is dedicated to fostering knowledge-sharing within the tech community.</p> <div class="flex"> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/mastodon-mark.DOW7pcjC_ZiQ1Y7.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/mastodon-mark-white.1vPKc5T6_1xDUxn.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/x-mark.B8UYXsYW_1Y4Mk2.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/x-mark-white.BH4tc0gU_1wSSrN.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/github-mark.BwyJR_2w_Z1xtQRt.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/github-mark-white.S2fJVXLq_Z1Xebf3.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/instagram-mark.Dwf86YqG_e2dgN.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/instagram-mark-white.DHEAU74k_Zb54zy.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/linkedin-mark.CxdoPt54_EsYgh.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/linkedin-mark-white.B4kIcZne_22Sl4n.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/rss-mark.yOoxdtkm_XDPhl.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/rss-mark-white.yB-N6eN0_qCtI.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> </div> </div> </div> </div> <nav class="toc sticky top-4 py-2 lg:-ml-3" data-astro-cid-awg4b4gg> <h3 class="font-extrabold uppercase mb-1 px-3 text-sm" data-astro-cid-awg4b4gg>On This Page</h3> <ul class="toc-list max-h-[calc(100vh-70px)] overflow-auto text-[.825rem] text-[var(--color-content-secondary)]" data-astro-cid-awg4b4gg>  </ul> </nav>  </div> </div>  </div> <footer class="container mt-8"> <div class="justify-center flex gap-4 py-8 prose dark:prose-invert text-sm"> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/mastodon-mark.DOW7pcjC_ZiQ1Y7.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/mastodon-mark-white.1vPKc5T6_1xDUxn.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/x-mark.B8UYXsYW_1Y4Mk2.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/x-mark-white.BH4tc0gU_1wSSrN.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/github-mark.BwyJR_2w_Z1xtQRt.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/github-mark-white.S2fJVXLq_Z1Xebf3.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/instagram-mark.Dwf86YqG_e2dgN.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/instagram-mark-white.DHEAU74k_Zb54zy.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/linkedin-mark.CxdoPt54_EsYgh.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/linkedin-mark-white.B4kIcZne_22Sl4n.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 dark:hidden" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/rss-mark.yOoxdtkm_XDPhl.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> <a class="p-3 hidden dark:block" href="https://github.com/devaradise/devolio" target="_blank"><img src="/_astro/rss-mark-white.yB-N6eN0_qCtI.svg" alt="Github logo" width="24" height="24" loading="lazy" decoding="async"></a> </div> <div class="py-4 border-t dark:border-t-zinc-700"> <div class="md:flex text-sm text-zinc-500 dark:text-zinc-300 prose dark:prose-invert justify-between"> <div>Copyright © 2024 Steven Lemonier</div> <!-- Please leave the credit if you dont make a significant changes to the template. It's just a nofollow link :)  --> <div>Template created by <a href="https://devaradise.com" target="_blank" rel="nofollow noopener">Syakir @ Devaradise</a> and adapted by Steven Lemonier</div> </div> </div> </footer> <!-- Google tag (gtag.js) -->  </body> </html> <script async>
	const anchors = document.querySelectorAll('.prose h2[id], .prose h3[id]');
	const links = document.querySelectorAll('nav.toc ul li a');

	function observeToc() {
		if (typeof anchors != 'undefined' && anchors != null && typeof links != 'undefined' && links != null) {
			let scrollTop = window.scrollY;

			// highlight the last scrolled-to: set everything inactive first
			for (const link of links) {
				link.classList.add('border-transparent', 'text-inherit');
				link.classList.remove('bg-[var(--background-surface-color)]', 'border-[var(--soft-border-color)]', 'text-[var(--link-color)]');
			}
			// then iterate backwards, on the first match highlight it and break
			for (var i = anchors.length - 1; i >= 0; i--) {
				if (scrollTop > anchors[i].offsetTop - 80) {
					links[i].classList.remove('border-transparent', 'text-inherit');
					links[i].classList.add('bg-[var(--background-surface-color)]', 'border-[var(--soft-border-color)]', 'text-[var(--link-color)]');
					break;
				}
			}
		}
	}

	window.addEventListener('scroll', (event) => {
		observeToc(event);
	});
	window.addEventListener('hashchange', (event) => {
		observeToc(event);
	});
</script>